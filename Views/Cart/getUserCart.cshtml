@model EasyGamesWeb.Models.Cart

@{
    ViewData["Title"] = "Your Cart";
    var lines = Model?.cartDetails ?? new List<EasyGamesWeb.Models.CartDetails>();
    decimal cartTotal = 0m;
}

<h1 class="mt-3 mb-3">Your Cart</h1>

@if (!lines.Any())
{
    <div class="alert alert-info">Your cart is empty.</div>
}
else
{
    <table class="table table-striped align-middle">
        <thead>
            <tr>
                <th>Product</th>
                <th class="text-end">Unit Price</th>
                <th class="text-end">Qty</th>
                <th class="text-end">Line Total</th>
                <th class="text-end">Stock Avail.</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var line in lines)
            {
                var p = line.Products;
                
                decimal unitPrice = (decimal)line.UnitPrice;
                decimal lineTotal = unitPrice * line.Quantity;
                cartTotal = cartTotal + lineTotal;

                
                int available = p?.Stocks?.Sum(s => (int?)s.Quantity) ?? 0;

                <tr>
                    <td>
                        <div>@p?.ProductName</div>
                        @if (!string.IsNullOrWhiteSpace(p?.ShortDesc))
                        {
                            <div class="text-muted small">@p.ShortDesc</div>
                        }
                        @if (p?.Category != null)
                        {
                            <div class="small">Category: @p.Category.CategoryName</div>
                        }
                    </td>
                    <td class="text-end">@unitPrice.ToString("C")</td>
                    <td class="text-end">@line.Quantity</td>
                    <td class="text-end">@lineTotal.ToString("C")</td>
                    <td class="text-end">@available</td>
                    <td class="text-end">
                        <a asp-action="RemoveItem" asp-controller="Cart" asp-route-productId="@line.ProductId" class="btn btn-sm btn-outline-danger">- Remove</a>
                    </td>
                </tr>
            }
        </tbody>
        <tfoot>
            <tr>
                <th colspan="3" class="text-end">Total</th>
                <th class="text-end">@cartTotal.ToString("C")</th>
                <th></th>
                <th></th>
            </tr>
        </tfoot>
    </table>

    <div class="mt-3">
        <a asp-action="Checkout" asp-controller="Cart" class="btn btn-primary">Proceed to Checkout</a>
        <a asp-action="Index" asp-controller="Home" class="btn btn-secondary">Continue Shopping</a>
    </div>
}
